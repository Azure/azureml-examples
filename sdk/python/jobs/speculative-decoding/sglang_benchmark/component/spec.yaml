$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
type: command

name: sglang_benchmark
display_name: SGLang Benchmark
description: Runs benchmark on AzureML online endpoint using SGLang.
version: 0.0.12
is_deterministic: true

inputs:
  scoring_url:
    type: string
    optional: false
    description: The URL of the endpoint.
  connection_name:
    type: string
    optional: false
    description: The name of the connection to fetch the API_KEY for the endpoint authentication.
  model:
    type: string
    optional: false
    description: HuggingFace repo ID of the model.
    default: nvidia/Llama-3.1-8B-Instruct-FP8
  backend:
    type: string
    optional: true
    description: Depending on the LLM Inference Engine.
    enum:
    - sglang
    - vllm
    default: sglang
  dataset_name:
    type: string
    optional: true
    description: Depending on the LLM Inference Engine.
    enum:
    - sharegpt
    default: sharegpt
  request_rate:
    type: integer
    optional: true
    description: The request rate per second for sending requests to the endpoint.
    default: 10
  num_prompts:
    type: integer
    optional: true
    description: The total number of prompts to send to the endpoint.
    default: 2500
  disable_shuffle:
    type: boolean
    optional: true
    description: Disable shuffling the dataset before sending requests.
    default: true
  trials:
    type: integer
    optional: true
    description: Number of trials to run the benchmark, result will be averaged over all trials.
    default: 5

outputs:
  metrics:
    type: uri_folder
    description: The output folder containing the benchmarking metrics.

code: ../src
environment: azureml://registries/test_centralus/environments/verl_trainer_rl/versions/7
command: >-
  python main.py
  --output-file ${{outputs.metrics}}
  --base-url ${{inputs.scoring_url}}
  --connection-name ${{inputs.connection_name}}
  --model ${{inputs.model}}
  $[[--trials ${{inputs.trials}}]]
  $[[--backend ${{inputs.backend}}]]
  $[[--dataset-name ${{inputs.dataset_name}}]]
  $[[--request-rate ${{inputs.request_rate}}]]
  $[[--num-prompts ${{inputs.num_prompts}}]]
  $[[--disable-shuffle ${{inputs.disable_shuffle}}]]
