type: pipeline
display_name: cifar-10-pipeline-example
jobs:
  get-data:
    command: bash main.sh ${{outputs.cifar}}
    code:
      local_path: src/get-data
    environment:
      image: python
    compute: azureml:cpu-cluster
    outputs:
      cifar:
  train-model:
    command: >-
      python main.py
      --cifar-dir ${{inputs.cifar}}
      --epochs ${{inputs.epochs}}
    code:
      local_path: src/train-model
    inputs:
      epochs: 1
      cifar: ${{jobs.get-data.outputs.cifar}}
    outputs:
      model:
    compute: azureml:gpu-cluster
    environment: azureml:AzureML-pytorch-1.9-ubuntu18.04-py37-cuda11-gpu
    distribution:
      type: pytorch
      process_count_per_instance: 2
    resources:
      instance_count: 2
  eval-model:
    command: >-
      echo "evaluating..."
    code:
      local_path: src/eval-model
    compute: azureml:cpu-cluster
    environment:
      image: python
    inputs:
      model: ${{jobs.train-model.outputs.model}}
