$schema: https://azuremlschemas.azureedge.net/latest/pipelineJob.schema.json
type: pipeline
display_name: pipeline_job_with_flow
description: The hello world pipeline job with flow as component

compute: "azureml:cpu-cluster"

inputs:
  flow_input:
    type: uri_file
    path: "./data/data.jsonl"

outputs:
  output_data:
    mode: mount
  debug_info:
    mode: mount

jobs:
  flow_node_from_dag:
    type: parallel
    component: ./basic/flow.dag.yaml
    inputs:
      data: ${{parent.inputs.flow_input}}
      text: "${data.text}"
    outputs:
      flow_outputs: ${{parent.outputs.output_data}}
      debug_info: ${{parent.outputs.debug_info}}
    environment_variables:
      # environment variables from connection
      AZURE_OPENAI_API_KEY: ${open_ai_connection.api_key}
      AZURE_OPENAI_API_BASE: ${open_ai_connection.api_base}
      AZURE_OPENAI_API_TYPE: azure

  flow_node_from_run:
    type: parallel
    component: ./run.yml
    inputs:
      data: ${{parent.inputs.flow_input}}
      text: "${data.text}"
