# Inference Schema
## Background 
[Inference Schema](https://github.com/Azure/InferenceSchema) is an open source library for ML applications maintained by Travis Angevine [@trangevi](https://github.com/trangevi) that streamlines schema design and development for ML applications and offers features such as parameter type definition, automatic type conversion, and schema/swagger file generation. Using Inference Schema, users can easily define parameter types and associate them to functions with input and output decorators. 

Inference Schema integrates directly with AzureML endpoints. User `run` functions with Inference Schema decorators can be defined with an arbitrary number of arguments and receive automatic swagger file generation at `/swagger.json`. 

## Usage
### Define Parameters
First, define input and output parameters using Inference Schema's `ParameterType` objects. `ParameterType` objects are instantiated using sample objects. 

There are four main types: 
- Python - `StandardPythonParameterType` 
- Numpy - `NumpyParameterType` 
- Pandas - `PandasParameterType`
- Spark - `SparkParameterType`

Nested parameters are permitted, and users can define their own parameters using the parent object `AbstractParameterType`. 

#### Standard Python Parameter Type
Standard Python Parameter Type objects include inbuilt data structures such as lists and dictionaries. 

``` 
StandardPythonParameterType(5) 
StandardPythonParameterType(["time", "exactly", "good", "else", "year"]) 
``` 

#### Numpy Parameter Type

``` 
NumpyParameterType(np.random.random(4)[np.newaxis, ...])
``` 

#### Pandas Paramter Type

```
pandas_sample_input = pd.DataFrame([{"group_id" : 1, "sentence": "Hello my dog is [MASK] and I love her"},
                                    {"group_id" : 2, "sentence": "What [MASK] is the show?"}])

PandasParameterType(pandas_sample_input)

``` 

#### Nested Parameter Type
Parameters are also able to be nested. Nested parameters are delivered as a dictionary and the elements are converted to the specified types by default. 

```
param_input_k = NumpyParameterType(np.array([5, 5]))
param_sentences = PandasParameterType(pd.DataFrame([{"sentence": "Hello my dog is [MASK] and I love her"},
                                                    {"sentence": "What [MASK] is the show?"}]))
param_input = StandardPythonParameterType({'sentences' : param_sentences,
                                           'top_k' : param_input_k})

```

#### Abstract (Custom) Parameter Type
Users can define custom parameter types using the parent class `AbstractParameterType` and overriding the `deserialize_input` and `input_to_swagger` methods. 

### Decorate Run Function 
Inference Schema provides two decorators - `input_schema` and `output_schema` - which can be applied to the `run` function. It is not necessary to apply both decorators and users can still take advantage of the automatic type conversion offered by the `input_schema` decorator without an `output_schema` decorator.

`input_schema` decorators can be stacked to define multiple arguments. 

``` 
@input_schema(param_name="masked_sentences", param_type=param_masked_sentences)
@input_schema(param_name="top_k", param_type=param_top_k)` 

def run(masked_sentences, top_k): 
``` 

`output_schema` decorators do not perform serialization, however, they are included in the schema generated by Inference Schema. 

# License Note
`bert-base-uncased` from HuggingFace is accessed in these examples and is distributed under the Apache License 2.0, which has been redistributed at `LICENSE`. 