name: cli-jobs-single-step-gpu_perf-gpu_perf_job-amlarc
on:
  workflow_dispatch:
    inputs:
      SUBSCRIPTION:
        description: Subscription ID
        required: false
        default: 6560575d-fa06-4e7d-95fb-f962e74efd7a
      RESOURCE_GROUP:
        description: Resource Group
        required: false
        default: azureml-examples-rg
      WORKSPACE:
        description: Workspace Name
        required: false
        default: amlarc-githubtest-ws
  schedule:
  - cron: 0 0/4 * * *
  pull_request:
    branches:
    - main
    paths:
    - cli/jobs/single-step/gpu_perf/**
    - .github/workflows/cli-jobs-single-step-gpu_perf-gpu_perf_job-amlarc.yml
    - .github/amlarc-tool.sh
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: check out repo
      uses: actions/checkout@v2
    - name: setup python
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'
      shell: bash
      run: |
        curl -sL https://aka.ms/InstallAzureCLIDeb | bash
    - name: install tools
      run: bash .github/amlarc-tool.sh install_tools
      timeout-minutes: 30
    - name: azure login
      uses: azure/login@v1
      with:
        creds: ${{secrets.AZ_AE_CREDS}}
      timeout-minutes: 30
    - name: run cli/jobs/single-step/gpu_perf/gpu_perf_job.yml
      run: |
        bash .github/amlarc-tool.sh run_cli_job cli/jobs/single-step/gpu_perf/gpu_perf_job.yml \
          -it gpu -cr
      continue-on-error: true
      timeout-minutes: 40
    env:
      SUBSCRIPTION: ${{ github.event.inputs.SUBSCRIPTION }}
      RESOURCE_GROUP: ${{ github.event.inputs.RESOURCE_GROUP }}
      WORKSPACE: ${{ github.event.inputs.WORKSPACE }}
